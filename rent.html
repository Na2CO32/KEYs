<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>é‘°åŒ™ç§Ÿå€Ÿç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="bg-white p-8 rounded-xl shadow-2xl w-96">
        <h2 class="text-2xl font-bold mb-6 text-gray-800 text-center">ğŸ”‘ é‘°åŒ™ç§Ÿå€Ÿç”³è«‹</h2>
        
        <form id="rentForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">é›»è©±</label>
                <input type="tel" name="phone" required class="mt-1 w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Email</label>
                <input type="email" name="email" required class="mt-1 w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none">
            </div>

            <div class="grid grid-cols-1 gap-3">
                {% for session in sessions %}
                <label class="relative block">
                    <input type="checkbox" name="timeslots" value="{{ session.name }}" class="peer sr-only">
                    <div class="p-4 bg-white border-2 border-gray-100 rounded-xl cursor-pointer transition-all duration-200
                                peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:shadow-md
                                hover:border-blue-200 hover:bg-slate-50 active:scale-[0.98]">
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-gray-700">{{ session.name }}</span>
                            <span class="text-sm font-medium text-blue-500 bg-blue-50 px-2 py-1 rounded-lg">{{ session.time }}</span>
                        </div>
                    </div>
                </label>
                {% endfor %}
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">é¸æ“‡é‘°åŒ™ç·¨è™Ÿ</label>
                <select name="key_id" required class="mt-1 w-full p-2 border-2 border-gray-200 rounded-md focus:ring-2 focus:ring-blue-500 outline-none">
                    <option value="" disabled selected>è«‹é¸æ“‡é‘°åŒ™</option>
                    {% for key in keys %}
                    <option value="{{ key }}">{{ key }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">4ä½æ•¸å¯†ç¢¼</label>
                <input type="password" name="password" maxlength="4" placeholder="ä¾‹å¦‚: a1b2" required 
                       class="mt-1 w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none">
            </div>

            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition duration-300 font-semibold shadow-md">
                ç«‹å³æäº¤ç”³è«‹
            </button>

            <div class="text-center mt-4">
                <a href="/" class="text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline transition-all">â† è¿”å›ç®¡ç†é¦–é </a>
            </div>
        </form>
    </div>

    <script>
        document.getElementById('rentForm').onsubmit = async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const response = await fetch('/submit_rent', { method: 'POST', body: formData });
            const result = await response.json();

            if (result.status === 'success') {
                Swal.fire({
                    icon: 'success',
                    title: 'é ç´„æˆåŠŸï¼',
                    text: result.message,
                    confirmButtonColor: '#2563eb'
                }).then(() => { window.location.href = '/'; });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'æäº¤å¤±æ•—',
                    text: result.message,
                    confirmButtonColor: '#2563eb'
                });
            }
        };
    </script>
    
    <script>
        document.getElementById('rentForm').onsubmit = async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
    
            // 1. å…ˆè·³å‡ºä¸€å€‹ã€Œé©—è­‰ä¸­ã€çš„æç¤ºï¼Œä¸¦éš±è—ç¢ºèªæŒ‰éˆ•ï¼Œé˜²æ­¢é‡è¤‡é»æ“Š
            Swal.fire({
                title: 'æ­£åœ¨é©—cing...',
                text: 'è«‹ç¨å€™ï¼Œç³»çµ±æ­£åœ¨å®‰å…¨æ ¸å°ä¸­',
                allowOutsideClick: false,
                showConfirmButton: false,
                didOpen: () => {
                    Swal.showLoading(); // é¡¯ç¤ºè½‰åœˆåœˆå‹•ç•«
                }
            });
    
            try {
                const response = await fetch('/submit_rent', { method: 'POST', body: formData });
                const result = await response.json();
    
                // é—œé–‰è½‰åœˆåœˆï¼Œé¡¯ç¤ºçµæœ
                Swal.close(); 
    
                if (result.status === 'success') {
                    Swal.fire({
                        icon: 'success',
                        title: 'é ç´„æˆåŠŸï¼',
                        text: result.message,
                        confirmButtonColor: '#2563eb'
                    }).then(() => { window.location.href = '/'; });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'é©—è­‰å¤±æ•—',
                        text: result.message,
                        confirmButtonColor: '#2563eb'
                    });
                }
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'ç¶²è·¯éŒ¯èª¤',
                    text: 'ç„¡æ³•é€£ç·šåˆ°ä¼ºæœå™¨ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚'
                });
            }
        };
    </script> 
</body>
</html>